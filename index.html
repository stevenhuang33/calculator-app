<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculator - Basic & Scientific</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1a1a2e;
      font-family: 'JetBrains+Mono', 'Fira Code', monospace;
      padding: 20px;
    }

    .calculator {
      background: #16213e;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 360px;
      transition: max-width 0.3s ease;
    }

    .calculator.scientific-mode {
      max-width: 600px;
    }

    .mode-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
      gap: 8px;
    }

    .toggle-btn {
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      border: 2px solid #533483;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 150ms ease;
      background: transparent;
      color: #eaeaea;
    }

    .toggle-btn.active {
      background: #533483;
    }

    .toggle-btn:hover {
      background: rgba(83, 52, 131, 0.5);
    }

    .display {
      background: #0f0f23;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      text-align: right;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .display-expression {
      font-size: 0.9rem;
      color: #7a7a8c;
      min-height: 1.2rem;
      word-break: break-all;
      margin-bottom: 4px;
    }

    .display-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #eaeaea;
      word-break: break-all;
      line-height: 1.1;
    }

    .button-container {
      display: flex;
      gap: 12px;
    }

    .scientific-buttons {
      display: none;
      flex-direction: column;
      gap: 12px;
      min-width: 200px;
    }

    .scientific-buttons.active {
      display: flex;
    }

    .sci-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      flex: 1;
    }

    .btn {
      font-family: inherit;
      font-size: 1.5rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 150ms ease;
      background: #1f4068;
      color: #eaeaea;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .btn.sci {
      font-size: 1.1rem;
      padding: 12px;
      background: #2a5a8a;
    }

    .btn.sci:hover {
      background: #3a6a9a;
    }

    .btn:hover {
      background: #2a5a8a;
      transform: scale(1.02);
    }

    .btn:active {
      transform: scale(0.98);
      background: #1a3555;
    }

    .btn.operator {
      background: #533483;
    }

    .btn.operator:hover {
      background: #6b44a8;
    }

    .btn.equals {
      background: #e94560;
      grid-row: span 2;
      height: 100%;
      min-height: 108px;
    }

    .btn.equals:hover {
      background: #ff5a75;
    }

    .btn.clear {
      background: #e94560;
    }

    .btn.clear:hover {
      background: #ff5a75;
    }

    .btn.zero {
      grid-column: span 2;
    }

    @media (max-width: 640px) {
      .calculator.scientific-mode {
        max-width: 360px;
      }

      .button-container {
        flex-direction: column;
      }

      .scientific-buttons {
        min-width: auto;
      }

      .sci-row {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (max-width: 400px) {
      .calculator {
        padding: 16px;
      }

      .btn {
        padding: 14px;
        font-size: 1.3rem;
      }

      .btn.sci {
        font-size: 0.9rem;
        padding: 10px;
      }

      .display-value {
        font-size: 2rem;
      }

      .display {
        padding: 16px;
        min-height: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="calculator" id="calculator">
    <div class="mode-toggle">
      <button class="toggle-btn active" id="basicMode">Basic</button>
      <button class="toggle-btn" id="scientificMode">Scientific</button>
    </div>

    <div class="display">
      <div class="display-expression" id="expression"></div>
      <div class="display-value" id="display">0</div>
    </div>

    <div class="button-container">
      <div class="scientific-buttons" id="scientificButtons">
        <div class="sci-row">
          <button class="btn sci" data-sci="sin">sin</button>
          <button class="btn sci" data-sci="cos">cos</button>
          <button class="btn sci" data-sci="tan">tan</button>
          <button class="btn sci" data-sci="sqrt">√</button>
        </div>
        <div class="sci-row">
          <button class="btn sci" data-sci="log">log</button>
          <button class="btn sci" data-sci="ln">ln</button>
          <button class="btn sci" data-sci="exp">e^x</button>
          <button class="btn sci" data-sci="pow">x²</button>
        </div>
        <div class="sci-row">
          <button class="btn sci" data-sci="pi">π</button>
          <button class="btn sci" data-sci="e">e</button>
          <button class="btn sci" data-sci="factorial">x!</button>
          <button class="btn sci" data-sci="percent">%</button>
        </div>
        <div class="sci-row">
          <button class="btn sci" data-sci="inverse">1/x</button>
          <button class="btn sci" data-sci="negate">±</button>
          <button class="btn sci" data-sci="abs">|x|</button>
          <button class="btn sci" data-sci="power">x^y</button>
        </div>
      </div>

      <div class="buttons">
        <button class="btn clear" data-action="clear">C</button>
        <button class="btn operator" data-action="divide">÷</button>
        <button class="btn operator" data-action="multiply">×</button>
        <button class="btn operator" data-action="backspace">⌫</button>
        
        <button class="btn" data-number="7">7</button>
        <button class="btn" data-number="8">8</button>
        <button class="btn" data-number="9">9</button>
        <button class="btn operator" data-action="subtract">-</button>
        
        <button class="btn" data-number="4">4</button>
        <button class="btn" data-number="5">5</button>
        <button class="btn" data-number="6">6</button>
        <button class="btn operator" data-action="add">+</button>
        
        <button class="btn" data-number="1">1</button>
        <button class="btn" data-number="2">2</button>
        <button class="btn" data-number="3">3</button>
        <button class="btn equals" data-action="equals">=</button>
        
        <button class="btn zero" data-number="0">0</button>
        <button class="btn" data-action="decimal">.</button>
      </div>
    </div>
  </div>

  <script>
    const display = document.getElementById('display');
    const expression = document.getElementById('expression');
    const calculator = document.getElementById('calculator');
    const scientificButtons = document.getElementById('scientificButtons');
    const basicModeBtn = document.getElementById('basicMode');
    const scientificModeBtn = document.getElementById('scientificMode');

    let currentValue = '0';
    let expressionDisplay = '';
    let previousValue = null;
    let operator = null;
    let shouldResetDisplay = false;
    let isScientificMode = false;
    let pendingPowerOperation = false;

    // Mode toggle
    basicModeBtn.addEventListener('click', () => {
      isScientificMode = false;
      calculator.classList.remove('scientific-mode');
      scientificButtons.classList.remove('active');
      basicModeBtn.classList.add('active');
      scientificModeBtn.classList.remove('active');
    });

    scientificModeBtn.addEventListener('click', () => {
      isScientificMode = true;
      calculator.classList.add('scientific-mode');
      scientificButtons.classList.add('active');
      scientificModeBtn.classList.add('active');
      basicModeBtn.classList.remove('active');
    });

    function updateDisplay() {
      let displayValue = currentValue;
      
      if (displayValue.length > 12) {
        displayValue = parseFloat(displayValue).toExponential(6);
      }
      
      if (displayValue === '' || displayValue === '-') {
        displayValue = displayValue || '0';
      }
      
      display.textContent = displayValue;
      expression.textContent = expressionDisplay;
    }

    function handleNumber(num) {
      if (shouldResetDisplay) {
        currentValue = num;
        shouldResetDisplay = false;
      } else if (currentValue === '0' && num !== '.') {
        currentValue = num;
      } else if (currentValue.length < 12) {
        currentValue += num;
      }
      updateDisplay();
    }

    function handleDecimal() {
      if (shouldResetDisplay) {
        currentValue = '0.';
        shouldResetDisplay = false;
      } else if (!currentValue.includes('.')) {
        currentValue += '.';
      }
      updateDisplay();
    }

    function handleOperator(op) {
      if (previousValue !== null && !shouldResetDisplay) {
        calculate();
      }
      
      switch (op) {
        case 'add':
          operator = '+';
          expressionDisplay = `${previousValue ?? currentValue} +`;
          break;
        case 'subtract':
          operator = '-';
          expressionDisplay = `${previousValue ?? currentValue} −`;
          break;
        case 'multiply':
          operator = '×';
          expressionDisplay = `${previousValue ?? currentValue} ×`;
          break;
        case 'divide':
          operator = '÷';
          expressionDisplay = `${previousValue ?? currentValue} ÷`;
          break;
      }
      
      previousValue = currentValue;
      shouldResetDisplay = true;
      updateDisplay();
    }

    function handleScientific(func) {
      const current = parseFloat(currentValue);
      let result;

      try {
        switch (func) {
          case 'sin':
            result = Math.sin(current * Math.PI / 180);
            expressionDisplay = `sin(${currentValue})`;
            break;
          case 'cos':
            result = Math.cos(current * Math.PI / 180);
            expressionDisplay = `cos(${currentValue})`;
            break;
          case 'tan':
            result = Math.tan(current * Math.PI / 180);
            expressionDisplay = `tan(${currentValue})`;
            break;
          case 'sqrt':
            if (current < 0) throw new Error('Invalid');
            result = Math.sqrt(current);
            expressionDisplay = `√(${currentValue})`;
            break;
          case 'log':
            if (current <= 0) throw new Error('Invalid');
            result = Math.log10(current);
            expressionDisplay = `log(${currentValue})`;
            break;
          case 'ln':
            if (current <= 0) throw new Error('Invalid');
            result = Math.log(current);
            expressionDisplay = `ln(${currentValue})`;
            break;
          case 'exp':
            result = Math.exp(current);
            expressionDisplay = `e^${currentValue}`;
            break;
          case 'pow':
            result = current * current;
            expressionDisplay = `${currentValue}²`;
            break;
          case 'pi':
            result = Math.PI;
            expressionDisplay = 'π';
            break;
          case 'e':
            result = Math.E;
            expressionDisplay = 'e';
            break;
          case 'factorial':
            if (current < 0 || current > 170) throw new Error('Invalid');
            result = factorial(Math.floor(current));
            expressionDisplay = `${Math.floor(current)}!`;
            break;
          case 'percent':
            result = current / 100;
            expressionDisplay = `${currentValue}%`;
            break;
          case 'inverse':
            if (current === 0) throw new Error('Division by zero');
            result = 1 / current;
            expressionDisplay = `1/${currentValue}`;
            break;
          case 'negate':
            result = -current;
            expressionDisplay = `-(${currentValue})`;
            break;
          case 'abs':
            result = Math.abs(current);
            expressionDisplay = `|${currentValue}|`;
            break;
          case 'power':
            operator = '^';
            previousValue = currentValue;
            shouldResetDisplay = true;
            expressionDisplay = `${currentValue} ^`;
            updateDisplay();
            return;
        }

        currentValue = result.toString();
        shouldResetDisplay = true;
        updateDisplay();
      } catch (e) {
        currentValue = 'Error';
        expressionDisplay = '';
        shouldResetDisplay = true;
        updateDisplay();
      }
    }

    function factorial(n) {
      if (n === 0 || n === 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) {
        result *= i;
      }
      return result;
    }

    function calculate() {
      if (operator === null || previousValue === null) return;
      
      const prev = parseFloat(previousValue);
      const curr = parseFloat(currentValue);
      let result;
      
      switch (operator) {
        case '+':
          result = prev + curr;
          break;
        case '-':
          result = prev - curr;
          break;
        case '×':
          result = prev * curr;
          break;
        case '÷':
          if (curr === 0) {
            currentValue = 'Error';
            expressionDisplay = '';
            previousValue = null;
            operator = null;
            shouldResetDisplay = true;
            updateDisplay();
            return;
          }
          result = prev / curr;
          break;
        case '^':
          result = Math.pow(prev, curr);
          break;
      }
      
      if (!isFinite(result)) {
        currentValue = 'Error';
        expressionDisplay = '';
      } else {
        const resultStr = result.toString();
        if (resultStr.length > 12) {
          currentValue = parseFloat(result.toPrecision(10)).toString();
        } else {
          currentValue = resultStr;
        }
        expressionDisplay = `${previousValue} ${getOperatorSymbol(operator)} ${currentValue}`;
      }
      
      previousValue = null;
      operator = null;
      shouldResetDisplay = true;
      updateDisplay();
    }

    function getOperatorSymbol(op) {
      switch (op) {
        case '+': return '+';
        case '-': return '−';
        case '×': return '×';
        case '÷': return '÷';
        case '^': return '^';
        default: return op;
      }
    }

    function clear() {
      currentValue = '0';
      expressionDisplay = '';
      previousValue = null;
      operator = null;
      shouldResetDisplay = false;
      updateDisplay();
    }

    function backspace() {
      if (currentValue.length > 1) {
        currentValue = currentValue.slice(0, -1);
      } else {
        currentValue = '0';
      }
      updateDisplay();
    }

    // Event listeners for basic buttons
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const number = btn.dataset.number;
        const action = btn.dataset.action;
        const sci = btn.dataset.sci;
        
        if (number !== undefined) {
          handleNumber(number);
        } else if (sci) {
          handleScientific(sci);
        } else if (action) {
          switch (action) {
            case 'clear':
              clear();
              break;
            case 'equals':
              calculate();
              break;
            case 'decimal':
              handleDecimal();
              break;
            case 'backspace':
              backspace();
              break;
            case 'add':
            case 'subtract':
            case 'multiply':
            case 'divide':
              handleOperator(action);
              break;
          }
        }
      });
    });

    // Keyboard support
    document.addEventListener('keydown', (e) => {
      const key = e.key;
      
      if (key >= '0' && key <= '9') {
        handleNumber(key);
        return;
      }
      
      if (key === '.' || key === ',') {
        handleDecimal();
        return;
      }
      
      switch (key) {
        case '+':
          handleOperator('add');
          break;
        case '-':
          handleOperator('subtract');
          break;
        case '*':
          handleOperator('multiply');
          break;
        case '/':
          e.preventDefault();
          handleOperator('divide');
          break;
        case 'Enter':
        case '=':
          e.preventDefault();
          calculate();
          break;
        case 'Escape':
          clear();
          break;
        case 'Backspace':
          backspace();
          break;
      }
    });
  </script>
</body>
</html>
