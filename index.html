<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #1a1a2e;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      padding: 20px;
    }

    .calculator {
      background: #16213e;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 360px;
    }

    .display {
      background: #0f0f23;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
      text-align: right;
      min-height: 100px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .display-expression {
      font-size: 0.9rem;
      color: #7a7a8c;
      min-height: 1.2rem;
      word-break: break-all;
      margin-bottom: 4px;
    }

    .display-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #eaeaea;
      word-break: break-all;
      line-height: 1.1;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .btn {
      font-family: inherit;
      font-size: 1.5rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 16px;
      cursor: pointer;
      transition: all 150ms ease;
      background: #1f4068;
      color: #eaeaea;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .btn:hover {
      background: #2a5a8a;
      transform: scale(1.02);
    }

    .btn:active {
      transform: scale(0.98);
      background: #1a3555;
    }

    .btn.operator {
      background: #533483;
    }

    .btn.operator:hover {
      background: #6b44a8;
    }

    .btn.equals {
      background: #e94560;
      grid-row: span 2;
      height: 100%;
      min-height: 108px;
    }

    .btn.equals:hover {
      background: #ff5a75;
    }

    .btn.clear {
      background: #e94560;
    }

    .btn.clear:hover {
      background: #ff5a75;
    }

    .btn.zero {
      grid-column: span 2;
    }

    @media (max-width: 400px) {
      .calculator {
        padding: 16px;
      }

      .btn {
        padding: 14px;
        font-size: 1.3rem;
      }

      .display-value {
        font-size: 2rem;
      }

      .display {
        padding: 16px;
        min-height: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="display">
      <div class="display-expression" id="expression"></div>
      <div class="display-value" id="display">0</div>
    </div>
    <div class="buttons">
      <button class="btn clear" data-action="clear">C</button>
      <button class="btn operator" data-action="divide">÷</button>
      <button class="btn operator" data-action="multiply">×</button>
      <button class="btn operator" data-action="backspace">⌫</button>
      
      <button class="btn" data-number="7">7</button>
      <button class="btn" data-number="8">8</button>
      <button class="btn" data-number="9">9</button>
      <button class="btn operator" data-action="subtract">-</button>
      
      <button class="btn" data-number="4">4</button>
      <button class="btn" data-number="5">5</button>
      <button class="btn" data-number="6">6</button>
      <button class="btn operator" data-action="add">+</button>
      
      <button class="btn" data-number="1">1</button>
      <button class="btn" data-number="2">2</button>
      <button class="btn" data-number="3">3</button>
      <button class="btn equals" data-action="equals">=</button>
      
      <button class="btn zero" data-number="0">0</button>
      <button class="btn" data-action="decimal">.</button>
    </div>
  </div>

  <script>
    const display = document.getElementById('display');
    const expression = document.getElementById('expression');

    let currentValue = '0';
    let expressionDisplay = '';
    let previousValue = null;
    let operator = null;
    let shouldResetDisplay = false;

    function updateDisplay() {
      let displayValue = currentValue;
      
      if (displayValue.length > 12) {
        displayValue = displayValue.slice(0, 12);
      }
      
      if (displayValue === '' || displayValue === '-') {
        displayValue = displayValue || '0';
      }
      
      if (displayValue.endsWith('.') && !displayValue.includes('.')) {
        displayValue = displayValue;
      }
      
      display.textContent = displayValue;
      expression.textContent = expressionDisplay;
    }

    function handleNumber(num) {
      if (shouldResetDisplay) {
        currentValue = num;
        shouldResetDisplay = false;
      } else if (currentValue === '0' && num !== '.') {
        currentValue = num;
      } else if (currentValue.length < 12) {
        currentValue += num;
      }
      updateDisplay();
    }

    function handleDecimal() {
      if (shouldResetDisplay) {
        currentValue = '0.';
        shouldResetDisplay = false;
      } else if (!currentValue.includes('.')) {
        currentValue += '.';
      }
      updateDisplay();
    }

    function handleOperator(op) {
      if (previousValue !== null && !shouldResetDisplay) {
        calculate();
      }
      
      switch (op) {
        case 'add':
          operator = '+';
          expressionDisplay = `${previousValue ?? currentValue} +`;
          break;
        case 'subtract':
          operator = '-';
          expressionDisplay = `${previousValue ?? currentValue} −`;
          break;
        case 'multiply':
          operator = '×';
          expressionDisplay = `${previousValue ?? currentValue} ×`;
          break;
        case 'divide':
          operator = '÷';
          expressionDisplay = `${previousValue ?? currentValue} ÷`;
          break;
      }
      
      previousValue = currentValue;
      shouldResetDisplay = true;
      updateDisplay();
    }

    function calculate() {
      if (operator === null || previousValue === null) return;
      
      const prev = parseFloat(previousValue);
      const curr = parseFloat(currentValue);
      let result;
      
      switch (operator) {
        case '+':
          result = prev + curr;
          break;
        case '-':
          result = prev - curr;
          break;
        case '×':
          result = prev * curr;
          break;
        case '÷':
          if (curr === 0) {
            currentValue = 'Error';
            expressionDisplay = '';
            previousValue = null;
            operator = null;
            shouldResetDisplay = true;
            updateDisplay();
            return;
          }
          result = prev / curr;
          break;
      }
      
      if (!isFinite(result)) {
        currentValue = 'Error';
        expressionDisplay = '';
      } else {
        const resultStr = result.toString();
        if (resultStr.length > 12) {
          currentValue = parseFloat(result.toPrecision(10)).toString();
        } else {
          currentValue = resultStr;
        }
        expressionDisplay = `${previousValue} ${getOperatorSymbol(operator)} ${currentValue}`;
      }
      
      previousValue = null;
      operator = null;
      shouldResetDisplay = true;
      updateDisplay();
    }

    function getOperatorSymbol(op) {
      switch (op) {
        case '+': return '+';
        case '-': return '−';
        case '×': return '×';
        case '÷': return '÷';
        default: return op;
      }
    }

    function clear() {
      currentValue = '0';
      expressionDisplay = '';
      previousValue = null;
      operator = null;
      shouldResetDisplay = false;
      updateDisplay();
    }

    function backspace() {
      if (currentValue.length > 1) {
        currentValue = currentValue.slice(0, -1);
      } else {
        currentValue = '0';
      }
      updateDisplay();
    }

    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const number = btn.dataset.number;
        const action = btn.dataset.action;
        
        if (number !== undefined) {
          handleNumber(number);
        } else if (action) {
          switch (action) {
            case 'clear':
              clear();
              break;
            case 'equals':
              calculate();
              break;
            case 'decimal':
              handleDecimal();
              break;
            case 'backspace':
              backspace();
              break;
            case 'add':
            case 'subtract':
            case 'multiply':
            case 'divide':
              handleOperator(action);
              break;
          }
        }
      });
    });

    document.addEventListener('keydown', (e) => {
      const key = e.key;
      
      if (key >= '0' && key <= '9') {
        handleNumber(key);
        return;
      }
      
      if (key === '.' || key === ',') {
        handleDecimal();
        return;
      }
      
      switch (key) {
        case '+':
          handleOperator('add');
          break;
        case '-':
          handleOperator('subtract');
          break;
        case '*':
          handleOperator('multiply');
          break;
        case '/':
          e.preventDefault();
          handleOperator('divide');
          break;
        case 'Enter':
        case '=':
          e.preventDefault();
          calculate();
          break;
        case 'Escape':
          clear();
          break;
        case 'Backspace':
          backspace();
          break;
      }
    });
  </script>
</body>
</html>
